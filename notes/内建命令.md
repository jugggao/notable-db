---
title: 内建命令
title_custom: true
tags: [Shell/Command]
created: 2022-10-09T02:53:09.916Z
modified: 2022-10-10T03:10:39.356Z
---

# 内建命令

内建命令 `builtin` 是包含在 Bash 工具集中的命令。使用内建命令通常出于性能原因或是需要直接存取 shell 内部变量的考量。内建命令执行速度比外部命令的执行速度快，因为外部命令通常需要派生出一个单独的进程执行。

命令或 shell 本身启动或生成一个子进程用于执行任务的操作被称为派生 forking。新生成的进程被称作子进程，而派生出子进程的进程被称作父进程。当子进程在执行任务时，父进程也仍在运行。

```shell
#!/usr/bin/env bash
# spawn.sh

PIDS=$(pidof sh "$0")                  # 脚本的多个实例的进程 ID
IFS=" " read -r -a P_ARRAY <<< "$PIDS" # 将进程 ID 放置到数组中（为什么？）
echo "$PIDS"

((instances = ${#P_ARRAY[*]} - 1))

echo "$instances instance(s) of this script running."
echo "[Hit Ctl-C to exit.]"
echo

sleep 1 # 闲置等待
sh "$0" # 再运行一次

exit 0 # 这不是必须的；脚本永远不会执行到这里。为什么不是必须的？

#  在键入 Ctl-C 退出脚本后，是否所有生成的脚本实例都会终止？
#  如果是，为什么？

# 注意：
# ----
# 注意不要长时间运行这个脚本。
# 它最终会占用大量的系统资源。

#  你认为让脚本生成大量的自身实例，是否是一个可取的编写脚本的技巧？
#  为什么？
```

通常来说，Bash 的内建命令不会在脚本中派生子进程来执行。而在脚本中调用外部系统命令或筛选器通常需要派生子进程。

一些内建命令可能与系统重名，但是这些都是在 Bash 内部重新实现后的命令。例如 Bash 中的 `echo` 命令与系统命令 `/bin/echo` 的功能基本一致，但是他们本质上并不一样。

```shell
$ type  -t echo
builtin

$ type -t /bin/echo
file
```

关键词 `keyword` 是保留使用的词汇、标记或运算符。关键词在 Shell 中具有特殊意义，是 Shell 语法的组成部分。例如 `for`、`while`、`do` 和 `!` 都是关键词。关键词与内建命令相似，它们都是硬编码到 Bash 中的。但是关键词本身不是命令，而是构成命令的子单位。

## 1. `echo`

### 1.1. 作用

打印一个字符串或变量到标准输出 `stdout`。

### 1.2. 用法

#### 1.2.1. 语法

```shell
echo [选项]... [字符串或变量]...
```

#### 1.2.2. 选项

```
  -n	结尾不换行
  -e	启用转义字符
  -E	不启用转义字符（默认）
```

#### 1.2.3. 转义符

使用 `-e` 选项时，若字符串出现以下字符，则进行特殊处理：

```
  \\      \ 字符
  \a      发出警告声音（BEL）
  \b      删除前一个字符
  \c      直接结尾并不换行（后面的字符串不会输出）
  \e      删除后一个字符
  \f      换页
  \n      换行
  \r      回车符
  \t      水平制表符
  \v      垂直制表符
```

### 1.3. 用例

#### 1.3.1. 禁止换行

默认情况下，每一个 `echo` 命令都会在最后打印一个终端换行符，使用 `-n` 可以禁止这个行为。

```shell
$ echo -n 'Hello'
# 等同于
$ echo -e 'Hello\c'
```

#### 1.3.2. 通过管道给一系列命令提供值

案例：判断变量是否包含字符串

```shell
if echo "$VAR" | grep -q txt; then # if [[ $VAR = *txt* ]]; then
    echo "$VAR contains the substring sequence \"txt\""
fi
```

#### 1.3.3. 与命令替换结合用于给变量赋值

案例：在当前目录更改所有文件名为小写

```shell
#!/usr/bin/env bash
#
# 将工作目录中的每个文件名更改为小写

for filename in *; do # 遍历目录下所有文件
    fname=$(basename "$filename")
    n=$(echo "$fname" | tr '[:upper:]' '[:lower:]') # 将名称标为小写
    [[ "$fname" == "$n" ]] || mv "$fname" "$n"      # 仅改变非全部小写的文件名
done

exit $?
```

### 1.4. 注意

`` echo `command`  `` 会删除 `command` 中生成的所有换行符。

```shell
$ ls -l /opt
total 16
drwxr-xr-x 3 3434 3434 4096 2022-06-22 16:32 alertmanager
drwxr-xr-x 3 root root 4096 2022-07-07 13:58 cni
drwx--x--x 4 root root 4096 2022-07-11 15:48 containerd
drwxr-xr-x 2 3434 3434 4096 2021-12-05 19:15 node_exporter

$ echo `ls -l /opt`
total 16 drwxr-xr-x 3 3434 3434 4096 2022-06-22 16:32 alertmanager drwxr-xr-x 3 root root 4096 2022-07-07 13:58 cni drwx--x--x 4 root root 4096 2022-07-11 15:48 containerd drwxr-xr-x 2 3434 3434 4096 2021-12-05 19:15 node_exporter
```

## 2. `printf`

### 2.1. 作用

格式化打印。

### 2.2. 用法

#### 2.2.1. 语法

```shell
printf [-v var] format [arguments]
```

#### 2.2.2. 选项

```
-v var  将结果输出到变量 var 中而不是标准输出（stdout）
```

#### 2.2.3. 转义符

```
\"          双引号
\\          反斜杠
\a          响铃
\b          退格
\c          截断输出
\e          退出
\f          翻页
\n          换行
\r          回车
\t          水平制表符
\v          竖直制表符
\NNN        八进制数 (1到3位数字)
\xHH        十六进制数 (1到2位数字)
\uHHHH      Unicode 字符附加 4 位十六进制数字
\UHHHHHHHH  Unicode 字符附加 8 位十六进制数字
%%          百分号
```

#### 2.2.4. 转换说明符

```
%a, %A          浮点数，十六进制 p-（%A 为 P-）记数法
%c              ASCII 字符，显示相对应参数的第一个字符
%d, %i          十进制整数
%e, %E          浮点数，分别为 e-（%E 为 E-）记数法
%f, %F          浮点数，十进制记数法
%g, %G          浮点数，根据数值不同自动选择 %f（%G 为 %F）或者 %e（%G 为 %E）。%e（%G 为 %E）格式在指数小于 -4 或者大于等于精度时使用
%s              字符串
%o              无符号八进制整数
%u              无符号十进制整数
%x, %X          十六进制数字 0f（%X 为 0F）的无符号十六进制整数
%%              百分号
```

#### 2.2.5. 长度修饰符

「整数转换说明符」包含 `%d`、`%i`、`%o`、`%u`、`%x` 和 `%X`。

「浮点转换说明符」包含 `%a`、`%A`、`%e`、`%E`、`%f`、`%F`、`%g`、`%G`。

```
digit(s)    字段宽度的最小值。如果该字段不能容纳要打印的数或者字符串，系统会使用更宽的字段
            示例：%4d
.digit(s)   精度。只使用 . 表示其后跟随一个零，所以 %.f 与 %.0f 相同
            示例：%5.2f
h           和整数转换说明符一起使用，表示一个 short char 或者 unsigned short int 类型数值
            示例：%hu、%hx、%6.4hd
hh          和整数转换说明符一起使用，表示一个 signed char 或者 unsigned char 类型数值
            示例：%hhu、%hhx、%6.4hhd
l           和整数转换说明符一起使用，表示一个 long int 或者 unsigned long int 类型数值
            示例：%ld、%8lu
ll          和整数转换说明符一起使用，表示一个 long long int 或 unsigned long long int 类型数值
            示例：%lld、%8llu
L           和浮点转换说明符一起使用，表示一个 long double 类型数值
            示例：%Lf、%10.4Le
j           和整数转换说明符一起使用，表示一个 intmax_t 或 uintmax_t 类型值
            示例：%jd、%8jX
z           和整数转换说明符一起使用，表示一个 size_t 或 ssize_t 类型值
            示例：%zd、%12zx
t           和整数转换说明符一起使用，表示一个 ptrdiff_t 类型值（与两个指针之间的差相对应的类型)
            示例：%td、%12ti
```

#### 标识符

```
#           使用转换说明符的可选形式。若为 %o，则以 0 开始；若为 %x 和 %X 格式，则以 0x 或 0X 开始；对于所有的浮点数形式，即使后面没有任何数字也将始终包含小数点；对于 %g 和 %G 格式，将防止尾随零被删除
            示例：%#o、%#8.0f、%+#10.3E
（空格）    示例
-           左对齐
            示例：%-20s
+       
```

### 2.3. 将格式化内容赋值给变量

```shell
$ printf -v PI "%1.2f" 3.1415926
$ echo $PI
3.14
```

###
